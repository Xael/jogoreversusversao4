<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Cache-Control Headers to prevent browser from loading old files -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title data-i18n="document.title">Reversus - Jogo Online</title>
    <link rel="icon" href="logo.png" type="image/png">
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.12.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
<div id="scalable-container">
    <!-- Audio Elements -->
    <audio id="music-player" loop></audio>
    <audio id="sfx-player"></audio>
    <audio id="popup-sfx-player"></audio>
    
    <!-- Sound Controls -->
    <button id="fullscreen-button" class="sound-button" data-i18n-title="controls.fullscreen_toggle_title">
        <svg id="fullscreen-icon-enter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg>
        <svg id="fullscreen-icon-exit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hidden"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></svg>
    </button>
    <div class="sound-controls">
        <button id="mute-button" class="sound-button">||</button>
        <button id="next-track-button" class="sound-button">&gt;</button>
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5">
    </div>

    <!-- UI Elements -->
    <div id="achievement-unlocked-toast" class="hidden">
        <span class="toast-icon">🏆</span>
        <span id="toast-text"></span>
    </div>

    <div id="daily-reward-toast" class="hidden">
        <span class="toast-icon">💰</span>
        <span id="reward-toast-text"></span>
    </div>

    <!-- User Profile & Login -->
    <div id="user-profile-display" class="user-profile-display hidden">
        <div id="friend-request-badge" class="friend-request-badge hidden">!</div>
        <img id="user-avatar" src="" alt="User Avatar">
        <div class="user-info">
             <span id="user-name"></span>
             <span id="user-coin-balance-header">🪙 0</span>
             <div class="xp-bar-container">
                 <div id="xp-bar-fill"></div>
                 <span id="xp-bar-text"></span>
             </div>
        </div>
        <div id="user-level" class="user-level"></div>
    </div>


    <!-- Splash Screen -->
    <div id="splash-screen" class="modal-overlay">
        <div id="splash-animation-container"></div>
        <div class="modal-content splash-content">
            <img src="logo.png" alt="Reversus Logo" id="splash-logo" class="splash-logo">
            <div class="splash-button-container">
                <div class="button-group vertical">
                    <button id="login-button" class="control-button btn-neutral-color" data-i18n="splash.login">LOGIN</button>
                    <button id="quick-start-button" class="control-button btn-p1-color" data-i18n="splash.quick_start">Início Rápido</button>
                    <button id="story-mode-button" class="control-button btn-p3-color" data-i18n="splash.story_mode">Modo História</button>
                    <button id="pvp-mode-button" class="control-button btn-p2-color hidden" data-i18n="splash.pvp_online">PVP Online</button>
                    <button id="event-button" class="control-button btn-neutral-color hidden" data-i18n="splash.event">Evento</button>
                    <button id="tournament-button" class="control-button btn-neutral-color hidden" data-i18n="splash.tournament">TORNEIO</button>
                    <button id="infinite-challenge-button" class="control-button hidden">
                        <span data-i18n="splash.infinite_challenge">DESAFIO INFINITO</span>
                        <div id="infinite-challenge-pot-display" data-i18n="infinite_challenge.pot_display" data-pot-value="0">🪙 0 🪙</div>
                    </button>
                    <button id="ranking-button" class="control-button btn-inversus-color" data-i18n="splash.ranking">Ranking</button>
                    <button id="inversus-mode-button" class="control-button btn-inversus-color hidden" data-i18n="splash.inversus">INVERSUS</button>
                </div>
            </div>
             <button id="info-button" class="info-button" data-i18n="splash.version">Versão 4.0</button>
             <div class="language-switcher">
                <button id="lang-pt-BR" class="lang-button active" title="Português (Brasil)">🇧🇷</button>
                <button id="lang-en-US" class="lang-button" title="English (US)">🇺🇸</button>
            </div>
        </div>
    </div>

    <!-- Story Start Options Modal -->
    <div id="story-start-options-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 data-i18n="setup.title">Modo História</h2>
            <p data-i18n="setup.description">Como você quer começar sua jornada?</p>
            <div class="button-group">
                <button id="story-new-game-button" class="control-button" data-i18n="splash.story_mode">Nova História</button>
                <button id="story-continue-game-button" class="control-button secondary" data-i18n="splash.continue" disabled>Continuar Jogo</button>
            </div>
            <button id="story-options-close-button" class="control-button cancel" style="margin-top: 1rem;" data-i18n="common.back">Voltar</button>
        </div>
    </div>

    <!-- Infinite Challenge Intro Modal -->
    <div id="infinite-challenge-intro-modal" class="modal-overlay hidden">
        <div id="infinite-challenge-bg"></div>
        <div class="modal-content">
            <img src="inversum1.png" alt="Inversus" id="infinite-challenge-intro-image">
            <p id="infinite-challenge-intro-text"></p>
            <div id="infinite-challenge-intro-options" class="button-group">
                <!-- Buttons will be injected here by JS -->
            </div>
        </div>
    </div>

    <!-- Infinite Challenge Buff Selection Modal -->
    <div id="infinite-challenge-buff-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 data-i18n="infinite_challenge.buff_selection_title">Vitória! Escolha um bônus para a próxima rodada:</h2>
            <div id="infinite-challenge-buff-cards" class="buff-cards-container">
                <!-- Buff cards will be injected here by JS -->
            </div>
            <div id="infinite-challenge-continue-container" class="hidden" style="margin-top: 1.5rem; text-align: center;">
                <button id="infinite-challenge-continue-btn" class="control-button">Continuar</button>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="event-modal" class="modal-overlay hidden">
        <div class="modal-content event-modal-content">
            <h2 id="event-title" data-i18n="event.title">Evento Mensal</h2>
            <div class="event-grid">
                <div class="event-character-panel">
                    <img src="" id="event-character-image" alt="Personagem do Evento">
                    <p id="event-character-name">Nome do Personagem</p>
                </div>
                <div class="event-details-panel">
                    <h3 data-i18n="event.challenge_title">Desafio do Mês</h3>
                    <p id="event-description" data-i18n="event.description">Vença o oponente do evento 3 vezes para ganhar uma recompensa exclusiva. Você só pode tentar uma vez por dia!</p>
                    <div class="event-ability-container">
                        <h4 data-i18n="event.ability_title">Habilidade Especial</h4>
                        <p id="event-ability-description">Descrição da habilidade única do oponente.</p>
                    </div>
                    <div class="event-progress-container">
                        <h4 data-i18n="event.progress_title">Progresso</h4>
                        <div id="event-progress-markers" class="event-progress-markers">
                            <!-- Progress markers will be rendered here by JS -->
                        </div>
                    </div>
                    <div class="event-reward-container">
                        <h4 data-i18n="event.reward_title">Recompensa Exclusiva</h4>
                        <p id="event-reward-text" data-i18n="event.reward_text_placeholder">Título: "O Visionário"</p>
                    </div>
                    <div id="event-status-text" class="event-status-text"></div>
                    <button id="challenge-event-button" class="control-button" data-i18n="event.challenge_button">Desafiar!</button>
                </div>
            </div>
            <button id="close-event-button" class="control-button cancel" data-i18n="common.close">Fechar</button>
        </div>
    </div>

    <!-- Ranking Modal -->
    <div id="ranking-modal" class="modal-overlay hidden">
        <div class="modal-content ranking-modal-content">
            <h2 class="ranking-title" data-i18n="ranking.title">🏆 Ranking 🏆</h2>
            <div class="info-tabs" id="ranking-tabs-container">
                <button class="info-tab-button active" data-tab="ranking-pvp" data-i18n="ranking.pvp_tab">PVP</button>
                <button class="info-tab-button" data-tab="ranking-infinite" data-i18n="ranking.infinite_tab">Desafio Infinito</button>
                <button class="info-tab-button" data-tab="ranking-tournament" data-i18n="ranking.tournament_tab">Torneio</button>
            </div>
            <div id="ranking-pvp-tab-content" class="info-tab-content active">
                <div id="ranking-container"></div>
                <div class="ranking-pagination" id="ranking-pagination"></div>
            </div>
            <div id="ranking-infinite-tab-content" class="info-tab-content">
                <div id="infinite-ranking-container"></div>
                <div class="ranking-pagination" id="infinite-ranking-pagination"></div>
            </div>
            <div id="ranking-tournament-tab-content" class="info-tab-content">
                <div id="tournament-ranking-container"></div>
                <div class="ranking-pagination" id="tournament-ranking-pagination"></div>
            </div>
            <button id="close-ranking-button" class="control-button cancel" style="margin-top: 1rem;" data-i18n="common.close">Fechar</button>
        </div>
    </div>

    <!-- App Container (Main Game UI) -->
    <div class="app-container hidden" id="app-container">
        
        <!-- Painel Esquerdo -->
        <div class="left-panel">
            <div class="logo-container">
                <img src="logo.png" alt="Reversus Logo" class="game-logo">
            </div>
            <div id="game-timer-container">00:00</div>
            
             <div class="chat-container">
                <div class="chat-header">
                    <h2 data-i18n="game.log_title">Histórico do Jogo</h2>
                </div>
                <div class="game-log" id="game-log"></div>
                <div class="chat-input-wrapper">
                    <input type="text" id="chat-input" data-i18n-placeholder="game.chat_placeholder" placeholder="Enviar mensagem (Enter)..." maxlength="150">
                </div>
                <div class="chat-controls-wrapper">
                    <button id="chat-filter-btn" data-i18n="chat.filter_button_label">FILTRAR</button>
                    <button id="chat-toggle-btn" data-i18n="chat.toggle_on">ON</button>
                </div>
            </div>

            <button id="debug-button">⚙️</button>
            <button id="xael-star-power" class="hidden">⭐</button>
        </div>
        
        <!-- Painel Central -->
        <div class="center-panel">
            <div class="center-panel-header">
                 <div class="team-scores-container hidden" id="team-scores-container"></div>
                 <div id="reversus-total-indicator" class="hidden" data-i18n="game.reversus_total_active">REVERSUS TOTAL ATIVO!</div>
                 <div id="pvp-pot-container" class="hidden"></div>
            </div>

            <div class="board-and-scores-wrapper">
                <div class="side-score-box player-1-score" id="left-score-box">
                    <span id="left-score-value">0</span>
                    <div id="left-score-status" class="side-score-status"></div>
                </div>
                
                <div class="game-board" id="game-board">
                    <!-- Board spaces will be rendered here by JS -->
                </div>
                 <div id="tournament-game-view" class="hidden">
                    <!-- Tournament leaderboard and matches will be rendered here by JS -->
                </div>

                <div class="side-score-box player-2-score" id="right-score-box">
                    <span id="right-score-value">0</span>
                    <div id="right-score-status" class="side-score-status"></div>
                </div>
            </div>

            <div class="actions-container">
                 <button id="cards-button" class="control-button" data-i18n="game.show_cards">Cartas</button>
                 <button id="end-turn-button" class="control-button" data-i18n="game.end_turn">Passar Turno</button>
            </div>
            
            <div id="player-1-area-container">
                 <!-- The human player's area will be injected here by JS -->
            </div>
            
            <div id="turn-countdown-timer" class="turn-countdown-timer hidden"></div>
        </div>

        <!-- Painel Direito -->
        <div class="right-panel" id="opponent-zones-container">
            <!-- Opponent areas will be injected here by JS -->
        </div>

    </div>

    <!-- Modals that appear over the game -->
    <div id="game-over-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 id="game-over-title" data-i18n="game_over.title">Fim de Jogo!</h2>
            <p id="game-over-message"></p>
            <button id="restart-button" class="control-button" data-i18n="game_over.play_again">Jogar Novamente</button>
        </div>
    </div>
    
    <div id="round-summary-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 id="round-summary-title"></h2>
            <p id="round-summary-winner-text"></p>
            <p id="round-summary-pot-text" class="round-summary-pot hidden"></p>
            <div id="round-summary-scores"></div>
            <button id="next-round-button" class="control-button" data-i18n="round_summary.next_round">Próxima Rodada</button>
        </div>
    </div>

    <div id="draw-start-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 id="draw-start-title" data-i18n="draw.title">Sorteio Inicial</h2>
            <div id="draw-start-cards-container" class="draw-start-cards-container"></div>
            <p id="draw-start-result-message" class="draw-result-message"></p>
        </div>
    </div>
    
     <div id="game-menu-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 data-i18n="controls.game_menu_title">Menu da Partida</h2>
            <div class="button-group vertical">
                <button id="menu-save-game-button" class="control-button" data-i18n="menu.save">Salvar Jogo</button>
                <button id="menu-exit-game-button" class="control-button cancel" data-i18n="menu.exit">Sair da Partida</button>
                <button id="game-menu-close-button" class="control-button secondary" data-i18n="menu.back_to_game">Voltar ao Jogo</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modals -->
    <div id="save-game-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 data-i18n="confirm.save_title">Salvar Jogo</h2>
            <p data-i18n="confirm.save_text">Deseja salvar estado atual do jogo?</p>
            <div class="button-group">
                <button id="save-game-yes-button" class="control-button" data-i18n="common.yes">Sim</button>
                <button id="save-game-no-button" class="control-button cancel" data-i18n="common.no">Não</button>
            </div>
        </div>
    </div>

    <div id="exit-game-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 data-i18n="confirm.exit_title">Sair da Partida</h2>
            <p data-i18n="confirm.exit_text">Deseja sair e voltar ao menu principal? O progresso não salvo será perdido.</p>
            <div class="button-group">
                <button id="exit-game-yes-button" class="control-button" data-i18n="confirm.exit_yes">Sim, Sair</button>
                <button id="exit-game-no-button" class="control-button cancel" data-i18n="common.no">Não</button>
            </div>
        </div>
    </div>

    <div id="xael-power-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 data-i18n="confirm.xael_power_title">Ativar Poder Estelar?</h2>
            <p data-i18n="confirm.xael_power_text">A habilidade "Revelação Estelar" revelará as mãos de todos os oponentes por uma rodada inteira. Esta ação não pode ser desfeita.</p>
            <div class="button-group">
                <button id="xael-power-confirm-yes" class="control-button" data-i18n="confirm.xael_power_yes">Ativar</button>
                <button id="xael-power-confirm-no" class="control-button cancel" data-i18n="common.no">Não</button>
            </div>
        </div>
    </div>

</div> <!-- End of scalable-container -->

<script type="module" src="index.tsx"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
